<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4.3 First Time leennR | Learning Extension of Exposures with Neural Networks in R</title>
  <meta name="description" content="4.3 First Time leennR | Learning Extension of Exposures with Neural Networks in R" />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="4.3 First Time leennR | Learning Extension of Exposures with Neural Networks in R" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4.3 First Time leennR | Learning Extension of Exposures with Neural Networks in R" />
  
  
  

<meta name="author" content="Charles Lindberg, FCAS" />


<meta name="date" content="2020-06-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="model-setup.html"/>
<link rel="next" href="poc.html"/>
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint/kePrint.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css\style.css" type="text/css" />
<link rel="stylesheet" href="css\fontawesome-free-5.7.2-web\css\solid.min" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Learning Extension of Exposures with Neural Networks in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Abstract</a></li>
<li class="chapter" data-level="" data-path="about-the-author.html"><a href="about-the-author.html"><i class="fa fa-check"></i>About the Author</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="extension-of-exposures.html"><a href="extension-of-exposures.html"><i class="fa fa-check"></i><b>1.1</b> Extension of Exposures</a></li>
<li class="chapter" data-level="1.2" data-path="why-neural-nets.html"><a href="why-neural-nets.html"><i class="fa fa-check"></i><b>1.2</b> Why neural nets?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="ratebooks.html"><a href="ratebooks.html"><i class="fa fa-check"></i><b>2</b> Rate Books and Rate Calculation Examples</a><ul>
<li class="chapter" data-level="2.1" data-path="homeowners.html"><a href="homeowners.html"><i class="fa fa-check"></i><b>2.1</b> Homeowners</a><ul>
<li class="chapter" data-level="2.1.1" data-path="homeowners.html"><a href="homeowners.html#homeowners---rating-algorithm"><i class="fa fa-check"></i><b>2.1.1</b> Homeowners - Rating Algorithm</a></li>
<li class="chapter" data-level="2.1.2" data-path="homeowners.html"><a href="homeowners.html#homeowners---rate-tables"><i class="fa fa-check"></i><b>2.1.2</b> Homeowners - Rate Tables</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="rating-calculation-examples.html"><a href="rating-calculation-examples.html"><i class="fa fa-check"></i><b>2.2</b> Rating Calculation Examples</a><ul>
<li class="chapter" data-level="2.2.1" data-path="rating-calculation-examples.html"><a href="rating-calculation-examples.html#homeowners-1"><i class="fa fa-check"></i><b>2.2.1</b> Homeowners</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="rate-book-complexity.html"><a href="rate-book-complexity.html"><i class="fa fa-check"></i><b>2.3</b> Rate Book Complexity</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="premium-data.html"><a href="premium-data.html"><i class="fa fa-check"></i><b>3</b> Generating Premium Data</a><ul>
<li class="chapter" data-level="3.1" data-path="uniformly-distributed-independent-mix-with-exact-features.html"><a href="uniformly-distributed-independent-mix-with-exact-features.html"><i class="fa fa-check"></i><b>3.1</b> Uniformly Distributed, Independent Mix, with Exact Features</a></li>
<li class="chapter" data-level="3.2" data-path="not-uniformly-distributed-independent-mix-of-business.html"><a href="not-uniformly-distributed-independent-mix-of-business.html"><i class="fa fa-check"></i><b>3.2</b> Not Uniformly Distributed, Independent Mix of Business</a></li>
<li class="chapter" data-level="3.3" data-path="not-uniformly-distributed-dependent-mix-of-business.html"><a href="not-uniformly-distributed-dependent-mix-of-business.html"><i class="fa fa-check"></i><b>3.3</b> Not Uniformly Distributed, Dependent Mix of Business</a></li>
<li class="chapter" data-level="3.4" data-path="generating-historical-book-of-business.html"><a href="generating-historical-book-of-business.html"><i class="fa fa-check"></i><b>3.4</b> Generating Historical Book of Business</a><ul>
<li class="chapter" data-level="3.4.1" data-path="generating-historical-book-of-business.html"><a href="generating-historical-book-of-business.html#uniformly-distributed"><i class="fa fa-check"></i><b>3.4.1</b> Uniformly Distributed</a></li>
<li class="chapter" data-level="3.4.2" data-path="generating-historical-book-of-business.html"><a href="generating-historical-book-of-business.html#rate-book-changes"><i class="fa fa-check"></i><b>3.4.2</b> Rate Book Changes</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="extreme-sample-bias.html"><a href="extreme-sample-bias.html"><i class="fa fa-check"></i><b>3.5</b> Extreme Sample Bias</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="first-time-fit.html"><a href="first-time-fit.html"><i class="fa fa-check"></i><b>4</b> Learning Extension of Exposures - Fitting a Dataset</a><ul>
<li class="chapter" data-level="4.1" data-path="data-preparation-and-required-packages.html"><a href="data-preparation-and-required-packages.html"><i class="fa fa-check"></i><b>4.1</b> Data Preparation and Required Packages</a></li>
<li class="chapter" data-level="4.2" data-path="model-setup.html"><a href="model-setup.html"><i class="fa fa-check"></i><b>4.2</b> Model Setup</a></li>
<li class="chapter" data-level="4.3" data-path="first-time-leennr.html"><a href="first-time-leennr.html"><i class="fa fa-check"></i><b>4.3</b> First Time leennR</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="poc.html"><a href="poc.html"><i class="fa fa-check"></i><b>5</b> leennr Proof of Concept</a><ul>
<li class="chapter" data-level="5.1" data-path="simulate-rate-changes-this-is-needed-to.html"><a href="simulate-rate-changes-this-is-needed-to.html"><i class="fa fa-check"></i><b>5.1</b> Simulate Rate Changes - this is needed to</a></li>
<li class="chapter" data-level="5.2" data-path="simulate-written-premium-transactions.html"><a href="simulate-written-premium-transactions.html"><i class="fa fa-check"></i><b>5.2</b> Simulate Written Premium Transactions</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="research.html"><a href="research.html"><i class="fa fa-check"></i><b>6</b> Research</a><ul>
<li class="chapter" data-level="6.1" data-path="number-of-price-points-and-needed-layers.html"><a href="number-of-price-points-and-needed-layers.html"><i class="fa fa-check"></i><b>6.1</b> Number of Price Points and Needed Layers</a></li>
<li class="chapter" data-level="6.2" data-path="testing-missing-features.html"><a href="testing-missing-features.html"><i class="fa fa-check"></i><b>6.2</b> Testing Missing Features</a></li>
<li class="chapter" data-level="6.3" data-path="is-it-right.html"><a href="is-it-right.html"><i class="fa fa-check"></i><b>6.3</b> Is it right?</a></li>
<li class="chapter" data-level="6.4" data-path="method.html"><a href="method.html"><i class="fa fa-check"></i><b>6.4</b> Method</a><ul>
<li class="chapter" data-level="6.4.1" data-path="method.html"><a href="method.html#does-it-matter-if-we-do-not-correlation-among-cohorts"><i class="fa fa-check"></i><b>6.4.1</b> Does it matter if we do not correlation among cohorts?</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="more.html"><a href="more.html"><i class="fa fa-check"></i><b>6.5</b> More</a><ul>
<li class="chapter" data-level="6.5.1" data-path="more.html"><a href="more.html#rating-expert-feedback"><i class="fa fa-check"></i><b>6.5.1</b> Rating Expert Feedback</a></li>
<li class="chapter" data-level="6.5.2" data-path="more.html"><a href="more.html#revisiting-rating-examples-with-deeper-nets"><i class="fa fa-check"></i><b>6.5.2</b> Revisiting Rating Examples with Deeper Nets</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="copybooks-and-cobol.html"><a href="copybooks-and-cobol.html"><i class="fa fa-check"></i><b>6.6</b> Copybooks and COBOL</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="generalized-parallelogram-method.html"><a href="generalized-parallelogram-method.html"><i class="fa fa-check"></i><b>A</b> Generalized Parallelogram Method</a><ul>
<li class="chapter" data-level="A.1" data-path="generalized-parallelogram-terms-and-formulas.html"><a href="generalized-parallelogram-terms-and-formulas.html"><i class="fa fa-check"></i><b>A.1</b> Generalized Parallelogram Terms and Formulas</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="_blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Learning Extension of Exposures with Neural Networks in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="first-time-leennr" class="section level2">
<h2><span class="header-section-number">4.3</span> First Time leennR</h2>
<p>Fitting the model is quite simple. This model will is trained for 1000 epochs.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" title="1">history &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb24-2" title="2"><span class="st">  </span>model <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb24-3" title="3"><span class="st">  </span><span class="kw">fit</span>(</a>
<a class="sourceLine" id="cb24-4" title="4">  x_train,</a>
<a class="sourceLine" id="cb24-5" title="5">  y_train, </a>
<a class="sourceLine" id="cb24-6" title="6">  <span class="dt">epochs =</span> <span class="dv">1000</span>, </a>
<a class="sourceLine" id="cb24-7" title="7">  <span class="dt">batch_size =</span> <span class="dv">1000</span>, </a>
<a class="sourceLine" id="cb24-8" title="8">  <span class="dt">validation_split =</span> <span class="fl">0.2</span>,</a>
<a class="sourceLine" id="cb24-9" title="9">  )</a></code></pre></div>
<p>The model summary, the fitting history, and the mean squared error are as follows.</p>
<pre><code>## Model: &quot;sequential&quot;
## _______________________________________________________
## Layer (type)            Output Shape          Param #  
## =======================================================
## dense (Dense)           (None, 64)            768      
## _______________________________________________________
## dense_1 (Dense)         (None, 32)            2080     
## _______________________________________________________
## dense_2 (Dense)         (None, 1)             33       
## =======================================================
## Total params: 2,881
## Trainable params: 2,881
## Non-trainable params: 0
## _______________________________________________________</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-15-1.svg" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## [1] &quot;Mean absolute error on test set: $26.73&quot;</code></pre>
<p>We can plot how far off the predictions are with histograms. The results show we have some additional research to perform if we want to refine the accuracy further. We’ll explore this further in the next section.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1"><span class="co"># predict %&gt;%  </span></a>
<a class="sourceLine" id="cb27-2" title="2"><span class="co">#   ggplot + </span></a>
<a class="sourceLine" id="cb27-3" title="3"><span class="co">#   geom_jitter(aes(x = premium, y = abs(y_hat - premium)/premium)) +</span></a>
<a class="sourceLine" id="cb27-4" title="4"><span class="co">#   xlab(&quot;Premium&quot;) +</span></a>
<a class="sourceLine" id="cb27-5" title="5"><span class="co">#   ylab(&quot;Absolute Error as % of Premium&quot;)</span></a>
<a class="sourceLine" id="cb27-6" title="6"></a>
<a class="sourceLine" id="cb27-7" title="7">predict <span class="op">%&gt;%</span><span class="st">  </span></a>
<a class="sourceLine" id="cb27-8" title="8"><span class="st">  </span>ggplot <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb27-9" title="9"><span class="st">  </span><span class="kw">geom_hex</span>(<span class="kw">aes</span>(<span class="dt">x =</span> premium, <span class="dt">y =</span> premium <span class="op">-</span><span class="st"> </span>y_hat)) <span class="op">+</span></a>
<a class="sourceLine" id="cb27-10" title="10"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Premium&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb27-11" title="11"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Premium - Fitted Value&quot;</span>)</a></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-16-1.svg" width="672" /></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" title="1"><span class="co"># predict_test %&gt;%  </span></a>
<a class="sourceLine" id="cb28-2" title="2"><span class="co">#   ggplot + </span></a>
<a class="sourceLine" id="cb28-3" title="3"><span class="co">#   geom_jitter(aes(x = premium, y = abs(y_hat - premium)/premium)) +</span></a>
<a class="sourceLine" id="cb28-4" title="4"><span class="co">#   xlab(&quot;Premium&quot;) +</span></a>
<a class="sourceLine" id="cb28-5" title="5"><span class="co">#   ylab(&quot;Absolute Error as % of Premium&quot;)</span></a>
<a class="sourceLine" id="cb28-6" title="6"></a>
<a class="sourceLine" id="cb28-7" title="7">predict_test <span class="op">%&gt;%</span><span class="st">  </span></a>
<a class="sourceLine" id="cb28-8" title="8"><span class="st">  </span>ggplot <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb28-9" title="9"><span class="st">  </span><span class="kw">geom_hex</span>(<span class="kw">aes</span>(<span class="dt">x =</span> premium, <span class="dt">y =</span> premium <span class="op">-</span><span class="st"> </span>y_hat)) <span class="op">+</span></a>
<a class="sourceLine" id="cb28-10" title="10"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Premium&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb28-11" title="11"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Premium - Fitted Value&quot;</span>) </a></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-16-2.svg" width="672" /></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" title="1">predict <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb29-2" title="2"><span class="st">  </span>ggplot <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb29-3" title="3"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> premium, <span class="dt">color =</span> <span class="st">&quot;premium&quot;</span>), <span class="dt">binwidth =</span> <span class="dv">50</span>, <span class="dt">color =</span> <span class="st">&quot;darkorange3&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb29-4" title="4"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> y_hat), <span class="dt">binwidth =</span> <span class="dv">50</span>, <span class="dt">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb29-5" title="5"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Premium Bin&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb29-6" title="6"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Number of Training Examples&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb29-7" title="7"><span class="st">  </span><span class="kw">theme_bw</span>()</a></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-17-1.svg" width="672" /></p>

</div>
<!-- </div> -->
            </section>

          </div>
        </div>
      </div>
<a href="model-setup.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="poc.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "<this doesn't work, but it should be the github page where this book lives>/4.00-first_time_fit.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown.pdf", "bookdown.epub", "bookdown.mobi"],
"toc": {
"collapse": "none"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
